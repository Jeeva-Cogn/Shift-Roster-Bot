<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPE ShiftBot - AI Roster Management</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5fbf">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NPE ShiftBot">
    
    <!-- SEO & Social Meta Tags -->
    <meta name="description" content="AI-powered shift roster management with health-conscious scheduling for NPE teams">
    <meta name="keywords" content="shift management, roster, AI scheduling, work-life balance, NPE, team management">
    <meta name="author" content="NPE Team">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="NPE ShiftBot - AI Roster Management">
    <meta property="og:description" content="Health-conscious AI scheduling that prioritizes work-life balance while maintaining operational efficiency">
    <meta property="og:type" content="website">
    <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIHZpZXdCb3g9IjAgMCAxMjAwIDYzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImJnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjOGI1ZmJmIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjYTM3NGQwIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iNjMwIiBmaWxsPSJ1cmwoI2JnKSIvPjx0ZXh0IHg9IjYwMCIgeT0iMjgwIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSI4MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn6SWIE5QRSBTaGlmdEJvdDwvdGV4dD48dGV4dCB4PSI2MDAiIHk9IjM2MCIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMzYiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgb3BhY2l0eT0iMC45Ij5BSSBSb3N0ZXIgTWFuYWdlbWVudCB3aXRoIEhlYWx0aC1Db25zY2lvdXMgU2NoZWR1bGluZzwvdGV4dD48L3N2Zz4=">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NPE ShiftBot - AI Roster Management">
    <meta name="twitter:description" content="Health-conscious AI scheduling for teams">
    
    <!-- Performance & Security -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjOGI1ZmJmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIi8+PHBhdGggZD0iTTEyIDFWM20wIDE4djJtMTEtMTJoLTJNNSAxMkgzbTEwLjUtNi5MTDE2IDRNNy41IDE3LjVMNiAxOW0wLTEzTDcuNSA3LjVtMTEgMUwxNyAxNy41Ii8+PC9zdmc+"
    
    <!-- External Dependencies with integrity checks -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Google Sites Compatible CSS */
        :root {
            --primary-color: #8b5fbf;
            --secondary-color: #a374d0;
            --background-color: #f3f0f8;
            --card-bg: #ffffff;
            --text-color: #4a4a4a;
            --text-light: #888;
            --border-color: #d4c5e0;
            --shadow: 0 4px 6px rgba(139, 95, 191, 0.15);
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #f3f0f8 0%, #e8dff0 100%);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #8b5fbf 0%, #a374d0 100%);
            color: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--text-color);
            min-width: 120px;
        }

        .tab:hover {
            background: var(--background-color);
        }

        .tab.active {
            background: linear-gradient(135deg, #8b5fbf 0%, #a374d0 100%);
            color: white;
        }

        .tab-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f6fb 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(139, 95, 191, 0.25);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #e8dff0 0%, #d4c5e0 100%);
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: fadeInScale 0.8s ease-out;
        }

        .stat-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(139, 95, 191, 0.3);
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            animation: countUp 1.5s ease-out;
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
            animation: fadeInLeft 0.8s ease-out;
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .compact-chart {
            height: 200px !important;
            margin: 10px 0;
            animation: fadeIn 1.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-top: 5px;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: linear-gradient(135deg, #8b5fbf 0%, #a374d0 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(139, 95, 191, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #868e96 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #34ce57 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ffcd39 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e15662 100%);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: linear-gradient(135deg, #e8dff0 0%, #d4c5e0 100%);
            font-weight: 600;
            color: var(--primary-color);
        }

        .table tr:hover {
            background-color: #f8f6fb;
        }

        .leave-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .calendar-day:hover {
            background-color: var(--background-color);
        }

        .calendar-day.selected {
            background: var(--primary-color);
            color: white;
        }

        .calendar-day.has-leave {
            background: linear-gradient(135deg, #ffc107 0%, #ffcd39 100%);
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border: 1px solid #b6e3ea;
            color: #0c5460;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                min-width: auto;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🤖 NPE ShiftBot</h1>
            <p>AI-Powered Roster Management with Health-Conscious Scheduling</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="tab" onclick="showTab('team')">👥 NPE Team</button>
            <button class="tab" onclick="showTab('leaves')">🏖️ Leave Management</button>
            <button class="tab" onclick="showTab('shifts')">⏰ Shifts</button>
            <button class="tab" onclick="showTab('generator')">🎯 Schedule Generator</button>
            <button class="tab" onclick="showTab('reports')">📈 Reports</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="cards-grid">
                <div class="card">
                    <h3>📊 NPE Team Workload Distribution</h3>
                    <canvas id="workloadChart" class="compact-chart"></canvas>
                </div>
                <div class="card">
                    <h3>📅 Current Month Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalEmployees">12</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="activeShifts">3</div>
                            <div class="stat-label">Active Shifts</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pendingLeaves">0</div>
                            <div class="stat-label">Pending Leaves</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="approvedLeaves">0</div>
                            <div class="stat-label">Approved Leaves</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <h3>🏖️ Leave Status Overview</h3>
                    <canvas id="leaveStatusChart" class="compact-chart"></canvas>
                </div>
                <div class="card">
                    <h3>⚡ Health & Wellness Metrics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="avgConsecutiveDays">3.2</div>
                            <div class="stat-label">Avg Consecutive Days</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="burnoutAlerts">0</div>
                            <div class="stat-label">Burnout Alerts</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NPE Team Tab -->
        <div id="team" class="tab-content">
            <div class="card">
                <h3>👥 NPE Team Members</h3>
                <table class="table" id="teamTable">
                    <thead>
                        <tr>
                            <th>CTS ID</th>
                            <th>ESHC</th>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Preferred Days Off</th>
                        </tr>
                    </thead>
                    <tbody id="teamTableBody">
                        <!-- Team data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Leave Management Tab -->
        <div id="leaves" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <h3>🏖️ Request Leave</h3>
                    <form id="leaveRequestForm">
                        <div class="form-group">
                            <label for="employeeSelect">Employee</label>
                            <select id="employeeSelect" required>
                                <option value="">Select Employee</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leaveDate">Leave Date</label>
                            <input type="date" id="leaveDate" required>
                        </div>
                        <div class="form-group">
                            <label for="leaveType">Leave Type</label>
                            <select id="leaveType" required>
                                <option value="">Select Type</option>
                                <option value="sick">Sick Leave</option>
                                <option value="vacation">Vacation</option>
                                <option value="personal">Personal</option>
                                <option value="emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="leaveReason">Reason (Optional)</label>
                            <textarea id="leaveReason" rows="3" placeholder="Brief reason for leave..."></textarea>
                        </div>
                        <button type="submit" class="btn">Submit Leave Request</button>
                    </form>
                </div>

                <div class="card">
                    <h3>📋 Pending Leave Requests</h3>
                    <div id="pendingLeavesList">
                        <!-- Pending leaves will be shown here -->
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>📅 Leave Calendar Overview</h3>
                <div id="leaveCalendar" class="leave-calendar">
                    <!-- Calendar will be generated here -->
                </div>
            </div>
        </div>

        <!-- Shifts Tab -->
        <div id="shifts" class="tab-content">
            <div class="card">
                <h3>⏰ Shift Configuration</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Shift</th>
                            <th>Time</th>
                            <th>Required Roles</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>S1 - Morning</td>
                            <td>06:00 AM - 04:00 PM IST</td>
                            <td>Shift Leads, Associates</td>
                            <td><span style="color: green;">✓ Active</span></td>
                        </tr>
                        <tr>
                            <td>S2 - Afternoon</td>
                            <td>01:00 PM - 11:00 PM IST</td>
                            <td>Leads, Shift Leads, Associates</td>
                            <td><span style="color: green;">✓ Active</span></td>
                        </tr>
                        <tr>
                            <td>S3 - Night</td>
                            <td>10:00 PM - 08:00 AM IST</td>
                            <td>Shift Leads, Associates</td>
                            <td><span style="color: green;">✓ Active</span></td>
                        </tr>
                        <tr>
                            <td>S4 - Special</td>
                            <td>12:30 PM - 10:30 PM IST</td>
                            <td>Leads</td>
                            <td><span style="color: orange;">⚠ As Needed</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Schedule Generator Tab -->
        <div id="generator" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <h3>🎯 AI Schedule Generator</h3>
                    <div class="alert alert-info">
                        <strong>Health-Conscious Scheduling:</strong> Our AI considers work-life balance, prevents burnout (max 6 consecutive days), and ensures proper rest periods.
                    </div>
                    <form id="scheduleForm">
                        <div class="form-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="numDays">Number of Days</label>
                            <select id="numDays" required>
                                <option value="7">1 Week</option>
                                <option value="14">2 Weeks</option>
                                <option value="30" selected>1 Month</option>
                                <option value="60">2 Months</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">🤖 Generate AI Schedule</button>
                        <button type="button" class="btn btn-secondary" onclick="downloadSchedule()">📥 Download Excel</button>
                    </form>
                </div>

                <div class="card">
                    <h3>⚡ Health Rules Applied</h3>
                    <ul style="list-style-type: none; padding: 0;">
                        <li style="margin: 10px 0; padding: 10px; background: #f8f6fb; border-radius: 5px;">
                            🛡️ <strong>WORK_LIFE_BALANCE:</strong> 5 days work + 2 days rest cycle
                        </li>
                        <li style="margin: 10px 0; padding: 10px; background: #f8f6fb; border-radius: 5px;">
                            🧠 <strong>STRESS_MANAGEMENT:</strong> Max 6 consecutive work days
                        </li>
                        <li style="margin: 10px 0; padding: 10px; background: #f8f6fb; border-radius: 5px;">
                            💚 <strong>MENTAL_HEALTH:</strong> Respects preferred days off
                        </li>
                        <li style="margin: 10px 0; padding: 10px; background: #f8f6fb; border-radius: 5px;">
                            ⚖️ <strong>FAIR_DISTRIBUTION:</strong> Equal workload across team
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h3>📊 Generated Schedule</h3>
                <div id="scheduleOutput">
                    <p style="text-align: center; color: var(--text-light); padding: 40px;">
                        Click "Generate AI Schedule" to create a health-conscious roster
                    </p>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <h3>📈 Workload Analytics</h3>
                    <canvas id="reportChart" class="compact-chart"></canvas>
                </div>
                <div class="card">
                    <h3>📊 Team Performance</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">98.5%</div>
                            <div class="stat-label">Schedule Adherence</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">4.2</div>
                            <div class="stat-label">Avg Days/Week</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">2.1</div>
                            <div class="stat-label">Avg Rest Days</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Violations</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real NPE Team Data - August 2025
        const npeTeamData = [
            // Leads
            { id: '593300', name: 'Dinesh Anbalagan', role: 'Lead', status: 'Active', daysOff: [1, 2], cts: '593300', eshc: 'EH0647' },
            { id: '560008', name: 'Mano', role: 'Lead', status: 'Active', daysOff: [1, 2], cts: '560008', eshc: 'EG4208' },
            
            // Shift Leads
            { id: '410093', name: 'Jeyakaran', role: 'Shift Lead', status: 'Active', daysOff: [2, 3], cts: '410093', eshc: 'EH6832' },
            { id: '2167353', name: 'Karthikeyan', role: 'Shift Lead', status: 'Active', daysOff: [0, 3], cts: '2167353', eshc: 'C7H8KH' },
            { id: '2054459', name: 'Panner', role: 'Shift Lead', status: 'Active', daysOff: [0, 6], cts: '2054459', eshc: 'C6X8FS' },
            { id: '2240608', name: 'Sai Kumar', role: 'Shift Lead', status: 'Active', daysOff: [3, 6], cts: '2240608', eshc: 'C7T7SF' },
            { id: '2136623', name: 'Manoj', role: 'Shift Lead', status: 'Active', daysOff: [4, 5], cts: '2136623', eshc: 'C8G3CW' },
            
            // Associates
            { id: '2054433', name: 'Sai Krishna', role: 'Associate', status: 'Active', daysOff: [0, 6], cts: '2054433', eshc: 'C6X7K5' },
            { id: '2299004', name: 'Jeeva', role: 'Associate', status: 'Active', daysOff: [1, 2], cts: '2299004', eshc: 'C8N5H4' },
            { id: '2309236', name: 'Saran', role: 'Associate', status: 'Active', daysOff: [1, 2], cts: '2309236', eshc: 'C8S7B6' },
            { id: '2328010', name: 'Akshay', role: 'Associate', status: 'Active', daysOff: [0, 6], cts: '2328010', eshc: 'C8W2BD' },
            { id: '2378392', name: 'Murugan', role: 'Associate', status: 'Active', daysOff: [4, 5], cts: '2378392', eshc: 'C9B7ZT' },
            { id: '2411200', name: 'Sahana P', role: 'Associate', status: 'Active', daysOff: [1, 2], cts: '2411200', eshc: 'C9G7D2' },
            { id: '2389541', name: 'Rengadurai', role: 'Associate', status: 'Active', daysOff: [1, 2], cts: '2389541', eshc: 'C9H4JZ' }
        ];

        // Real August 2025 Schedule Data
        const realAugust2025Schedule = {
            '2025-08-01': { 'S1': ['Jeyakaran', 'Manoj', 'Sahana P'], 'S2': ['Sai Kumar', 'Murugan'], 'S3': ['Karthikeyan', 'Saran', 'Jeeva', 'Rengadurai'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-02': { 'S1': ['Jeyakaran', 'Manoj'], 'S2': ['Sai Kumar', 'Murugan'], 'S3': ['Panner', 'Akshay'] },
            '2025-08-03': { 'S1': [], 'S2': ['Manoj', 'Sai Krishna'], 'S3': ['Panner', 'Akshay', 'Murugan'] },
            '2025-08-04': { 'S1': ['Karthikeyan', 'Jeeva', 'Saran'], 'S2': ['Jeyakaran', 'Sai Krishna', 'Rengadurai'], 'S3': ['Panner', 'Akshay', 'Sahana P'] },
            '2025-08-05': { 'S1': ['Karthikeyan', 'Jeeva', 'Saran'], 'S2': ['Dinesh Anbalagan', 'Jeyakaran', 'Sai Krishna', 'Rengadurai'], 'S3': ['Panner', 'Akshay', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-06': { 'S1': ['Karthikeyan', 'Jeeva', 'Saran'], 'S2': ['Dinesh Anbalagan', 'Jeyakaran', 'Sai Krishna', 'Sai Kumar', 'Rengadurai'], 'S3': ['Panner', 'Manoj', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-07': { 'S1': ['Karthikeyan', 'Jeeva', 'Saran'], 'S2': ['Jeyakaran', 'Sai Kumar', 'Rengadurai'], 'S3': ['Panner', 'Manoj', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-08': { 'S1': ['Karthikeyan', 'Jeeva', 'Saran'], 'S2': ['Jeyakaran', 'Sai Kumar', 'Rengadurai'], 'S3': ['Panner', 'Manoj', 'Akshay', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-09': { 'S1': ['Karthikeyan', 'Jeeva'], 'S2': ['Akshay', 'Murugan'], 'S3': ['Panner', 'Sai Krishna'] },
            '2025-08-10': { 'S1': ['Karthikeyan'], 'S2': ['Akshay', 'Murugan'], 'S3': ['Panner', 'Sai Krishna'] },
            '2025-08-11': { 'S1': ['Karthikeyan', 'Sahana P'], 'S2': ['Dinesh Anbalagan', 'Saran', 'Akshay', 'Murugan'], 'S3': ['Panner', 'Sai Krishna', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-12': { 'S1': ['Karthikeyan', 'Sahana P'], 'S2': ['Dinesh Anbalagan', 'Saran', 'Akshay', 'Murugan'], 'S3': ['Panner', 'Sai Krishna', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-13': { 'S1': ['Karthikeyan', 'Manoj', 'Sahana P'], 'S2': ['Dinesh Anbalagan', 'Saran', 'Akshay', 'Murugan'], 'S3': ['Jeyakaran', 'Sai Krishna', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-14': { 'S1': ['Karthikeyan', 'Manoj', 'Jeeva', 'Sahana P'], 'S2': ['Dinesh Anbalagan', 'Saran', 'Rengadurai'], 'S3': ['Jeyakaran', 'Sai Krishna', 'Murugan'], 'S4': ['Mano'] },
            '2025-08-15': { 'S1': ['Karthikeyan', 'Manoj', 'Jeeva'], 'S2': ['Dinesh Anbalagan', 'Akshay', 'Murugan'], 'S3': ['Jeyakaran', 'Sai Krishna', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-16': { 'S1': ['Karthikeyan', 'Manoj'], 'S2': ['Akshay', 'Murugan'], 'S3': ['Jeyakaran', 'Panner'] },
            '2025-08-17': { 'S1': ['Manoj'], 'S2': ['Akshay', 'Murugan'], 'S3': ['Jeyakaran', 'Panner'] },
            '2025-08-18': { 'S1': ['Jeyakaran', 'Sai Krishna'], 'S2': ['Sahana P', 'Akshay'], 'S3': ['Sai Kumar', 'Panner', 'Jeeva', 'Rengadurai'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-19': { 'S1': ['Jeyakaran', 'Sai Krishna'], 'S2': ['Sahana P', 'Akshay'], 'S3': ['Sai Kumar', 'Panner', 'Jeeva', 'Rengadurai'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-20': { 'S1': ['Karthikeyan', 'Sai Krishna'], 'S2': ['Sahana P', 'Akshay', 'Murugan'], 'S3': ['Sai Kumar', 'Panner', 'Jeeva', 'Rengadurai'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-21': { 'S1': ['Karthikeyan', 'Sai Krishna'], 'S2': ['Sahana P', 'Akshay', 'Murugan'], 'S3': ['Sai Kumar', 'Panner', 'Jeeva', 'Rengadurai'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-22': { 'S1': ['Karthikeyan', 'Sai Krishna'], 'S2': ['Sahana P', 'Akshay', 'Murugan'], 'S3': ['Sai Kumar', 'Panner', 'Jeeva', 'Saran'], 'S4': ['Dinesh Anbalagan'] },
            '2025-08-23': { 'S1': ['Karthikeyan'], 'S2': ['Sahana P', 'Akshay'], 'S3': ['Sai Kumar', 'Panner', 'Saran'] },
            '2025-08-24': { 'S1': ['Karthikeyan'], 'S2': ['Sahana P', 'Akshay'], 'S3': ['Sai Kumar', 'Panner', 'Saran'] },
            '2025-08-25': { 'S1': ['Jeyakaran', 'Murugan'], 'S2': ['Sai Kumar', 'Sai Krishna'], 'S3': ['Panner', 'Jeeva', 'Saran', 'Rengadurai'] },
            '2025-08-26': { 'S1': ['Jeyakaran', 'Murugan'], 'S2': ['Sai Kumar', 'Sai Krishna'], 'S3': ['Panner', 'Jeeva', 'Saran', 'Rengadurai'] },
            '2025-08-27': { 'S1': ['Jeyakaran', 'Murugan'], 'S2': ['Dinesh Anbalagan', 'Sai Kumar', 'Sai Krishna'], 'S3': ['Saran', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-28': { 'S1': ['Jeyakaran', 'Karthikeyan', 'Murugan', 'Sahana P'], 'S2': ['Dinesh Anbalagan', 'Sai Kumar', 'Sai Krishna', 'Jeeva'], 'S3': ['Saran', 'Rengadurai'], 'S4': ['Mano'] },
            '2025-08-29': { 'S1': ['Jeyakaran', 'Karthikeyan', 'Murugan', 'Jeeva'], 'S2': ['Dinesh Anbalagan', 'Akshay'], 'S3': ['Sai Kumar', 'Saran', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-30': { 'S1': ['Jeyakaran', 'Karthikeyan'], 'S2': ['Dinesh Anbalagan', 'Akshay', 'Murugan'], 'S3': ['Sai Kumar', 'Saran', 'Sahana P'], 'S4': ['Mano'] },
            '2025-08-31': { 'S1': ['Jeyakaran', 'Karthikeyan'], 'S2': ['Dinesh Anbalagan', 'Akshay', 'Murugan'], 'S3': ['Sai Kumar', 'Saran', 'Jeeva', 'Sahana P'], 'S4': ['Mano'] }
        };

        // Real leave data for August 2025
        const realLeaveData = [
            { id: 'leave001', employeeId: '593300', employeeName: 'Dinesh Anbalagan', date: '2025-08-07', type: 'personal', reason: 'Personal work', status: 'approved', requestDate: '2025-07-25T10:00:00Z' },
            { id: 'leave002', employeeId: '593300', employeeName: 'Dinesh Anbalagan', date: '2025-08-08', type: 'personal', reason: 'Personal work', status: 'approved', requestDate: '2025-07-25T10:00:00Z' },
            { id: 'leave003', employeeId: '2240608', employeeName: 'Sai Kumar', date: '2025-08-04', type: 'sick', reason: 'Medical appointment', status: 'approved', requestDate: '2025-08-01T09:00:00Z' },
            { id: 'leave004', employeeId: '410093', employeeName: 'Jeyakaran', date: '2025-08-23', type: 'vacation', reason: 'Family function', status: 'approved', requestDate: '2025-08-10T14:30:00Z' },
            { id: 'leave005', employeeId: '410093', employeeName: 'Jeyakaran', date: '2025-08-24', type: 'vacation', reason: 'Family function', status: 'approved', requestDate: '2025-08-10T14:30:00Z' },
            { id: 'leave006', employeeId: '2136623', employeeName: 'Manoj', date: '2025-08-13', type: 'sick', reason: 'Fever', status: 'approved', requestDate: '2025-08-12T08:00:00Z' },
            { id: 'leave007', employeeId: '2299004', employeeName: 'Jeeva', date: '2025-08-12', type: 'personal', reason: 'Personal work', status: 'approved', requestDate: '2025-08-05T16:00:00Z' },
            { id: 'leave008', employeeId: '2328010', employeeName: 'Akshay', date: '2025-08-28', type: 'emergency', reason: 'Family emergency', status: 'approved', requestDate: '2025-08-27T20:00:00Z' }
        ];

        // Real leave management system with actual data
        let leaveRequests = [...realLeaveData];
        let scheduleData = {...realAugust2025Schedule};

        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Initialize tab-specific content
            if (tabName === 'dashboard') {
                initDashboard();
            } else if (tabName === 'team') {
                loadTeamData();
            } else if (tabName === 'leaves') {
                initLeaveManagement();
            } else if (tabName === 'reports') {
                initReports();
            }
        }

        // Initialize Dashboard
        function initDashboard() {
            // Workload Distribution Chart with Enhanced Animations
            const ctx1 = document.getElementById('workloadChart').getContext('2d');
            
            // Create gradient backgrounds
            const gradient1 = ctx1.createLinearGradient(0, 0, 0, 200);
            gradient1.addColorStop(0, '#8b5fbf');
            gradient1.addColorStop(0.5, '#a374d0');
            gradient1.addColorStop(1, '#b794d1');
            
            const gradient2 = ctx1.createLinearGradient(0, 0, 0, 200);
            gradient2.addColorStop(0, '#4facfe');
            gradient2.addColorStop(0.5, '#00f2fe');
            gradient2.addColorStop(1, '#43e97b');
            
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['👨‍💼 Leads', '👥 Associates'],
                    datasets: [{
                        data: [2, 12],  // 2 Leads, 12 Shift Leads + Associates
                        backgroundColor: [gradient1, gradient2],
                        borderColor: ['#ffffff', '#ffffff'],
                        borderWidth: 3,
                        hoverBorderWidth: 5,
                        hoverBorderColor: ['#ffd700', '#ffd700'],
                        hoverBackgroundColor: [
                            '#9d73d4', // Lighter purple for leads
                            '#5bc0de'  // Lighter blue for associates
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000,
                        easing: 'easeInOutBounce'
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                color: '#4a4a4a'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#8b5fbf',
                            borderWidth: 2,
                            cornerRadius: 10,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} members (${percentage}%)`;
                                }
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });

            // Leave Status Chart with Enhanced Animations
            const ctx2 = document.getElementById('leaveStatusChart').getContext('2d');
            
            // Create gradients for bar chart
            const pendingGradient = ctx2.createLinearGradient(0, 0, 0, 200);
            pendingGradient.addColorStop(0, '#ffd93d');
            pendingGradient.addColorStop(1, '#ff9500');
            
            const approvedGradient = ctx2.createLinearGradient(0, 0, 0, 200);
            approvedGradient.addColorStop(0, '#43e97b');
            approvedGradient.addColorStop(1, '#38c172');
            
            const availableGradient = ctx2.createLinearGradient(0, 0, 0, 200);
            availableGradient.addColorStop(0, '#8b5fbf');
            availableGradient.addColorStop(1, '#6b46c1');
            
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['⏳ Pending', '✅ Approved', '👥 Available'],
                    datasets: [{
                        data: [0, 8, 14],  // 0 Pending, 8 Approved leaves, 14 Available team members
                        backgroundColor: [pendingGradient, approvedGradient, availableGradient],
                        borderColor: ['#ff9500', '#38c172', '#6b46c1'],
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                        hoverBackgroundColor: ['#ffb84d', '#4ade80', '#8b5fbf'],
                        hoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart',
                        delay: (context) => {
                            return context.dataIndex * 300; // Stagger animation
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#8b5fbf',
                            borderWidth: 2,
                            cornerRadius: 10,
                            displayColors: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return tooltipItems[0].label.replace(/[⏳✅👥]/g, '').trim();
                                },
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const suffix = context.label.includes('Available') ? ' team members' : ' requests';
                                    return `${value}${suffix}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(139, 95, 191, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });

            updateDashboardStats();
        }

        // Update Dashboard Statistics with real data
        function updateDashboardStats() {
            document.getElementById('totalEmployees').textContent = npeTeamData.length; // 14 total
            document.getElementById('activeShifts').textContent = '4'; // S1, S2, S3, S4
            document.getElementById('pendingLeaves').textContent = leaveRequests.filter(l => l.status === 'pending').length;
            document.getElementById('approvedLeaves').textContent = leaveRequests.filter(l => l.status === 'approved').length;
            
            // Update health metrics with real calculations
            const avgConsecutiveDays = calculateAverageConsecutiveDays();
            document.getElementById('avgConsecutiveDays').textContent = avgConsecutiveDays.toFixed(1);
            document.getElementById('burnoutAlerts').textContent = '0'; // No burnout alerts in current schedule
        }

        // Calculate average consecutive working days from real schedule
        function calculateAverageConsecutiveDays() {
            let totalConsecutiveDays = 0;
            let employeeCount = 0;
            
            npeTeamData.forEach(employee => {
                let consecutiveDays = 0;
                let maxConsecutive = 0;
                
                // Check each day in August 2025
                for (let day = 1; day <= 31; day++) {
                    const dateStr = `2025-08-${String(day).padStart(2, '0')}`;
                    const daySchedule = scheduleData[dateStr];
                    
                    if (daySchedule) {
                        let isWorking = false;
                        Object.values(daySchedule).forEach(shift => {
                            if (shift.includes(employee.name)) {
                                isWorking = true;
                            }
                        });
                        
                        if (isWorking) {
                            consecutiveDays++;
                            maxConsecutive = Math.max(maxConsecutive, consecutiveDays);
                        } else {
                            consecutiveDays = 0;
                        }
                    }
                }
                
                totalConsecutiveDays += maxConsecutive;
                employeeCount++;
            });
            
            return employeeCount > 0 ? totalConsecutiveDays / employeeCount : 0;
        }

        // Load Team Data with real employee information
        function loadTeamData() {
            const tbody = document.getElementById('teamTableBody');
            tbody.innerHTML = '';
            
            npeTeamData.forEach(member => {
                const row = document.createElement('tr');
                const daysOffText = member.daysOff.map(day => {
                    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    return days[day];
                }).join(', ');
                
                let roleColor = '#8b5fbf'; // Default purple
                if (member.role === 'Lead') roleColor = '#dc3545'; // Red for leads
                else if (member.role === 'Shift Lead') roleColor = '#ffc107'; // Orange for shift leads
                else if (member.role === 'Associate') roleColor = '#28a745'; // Green for associates
                
                row.innerHTML = `
                    <td><strong>${member.cts}</strong></td>
                    <td><code>${member.eshc}</code></td>
                    <td><strong>${member.name}</strong></td>
                    <td><span style="padding: 3px 8px; border-radius: 12px; font-size: 12px; background: ${roleColor}; color: white;">${member.role}</span></td>
                    <td><span style="color: green;">✓ ${member.status}</span></td>
                    <td>${daysOffText}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize Leave Management
        function initLeaveManagement() {
            // Populate employee select
            const select = document.getElementById('employeeSelect');
            select.innerHTML = '<option value="">Select Employee</option>';
            npeTeamData.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                select.appendChild(option);
            });

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('leaveDate').value = today;

            updateLeaveRequests();
            generateLeaveCalendar();
        }

        // Handle Leave Request Form
        document.getElementById('leaveRequestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const employeeId = document.getElementById('employeeSelect').value;
            const leaveDate = document.getElementById('leaveDate').value;
            const leaveType = document.getElementById('leaveType').value;
            const leaveReason = document.getElementById('leaveReason').value;
            
            if (!employeeId || !leaveDate || !leaveType) {
                alert('Please fill all required fields!');
                return;
            }

            const employee = npeTeamData.find(e => e.id === employeeId);
            const request = {
                id: Date.now().toString(),
                employeeId: employeeId,
                employeeName: employee.name,
                date: leaveDate,
                type: leaveType,
                reason: leaveReason,
                status: 'pending',
                requestDate: new Date().toISOString()
            };

            leaveRequests.push(request);
            updateLeaveRequests();
            updateDashboardStats();
            
            // Reset form
            this.reset();
            document.getElementById('leaveDate').value = new Date().toISOString().split('T')[0];
            
            alert('Leave request submitted successfully!');
        });

        // Update Leave Requests Display
        function updateLeaveRequests() {
            const container = document.getElementById('pendingLeavesList');
            const pendingLeaves = leaveRequests.filter(l => l.status === 'pending');
            
            if (pendingLeaves.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 20px;">No pending leave requests</p>';
                return;
            }
            
            container.innerHTML = pendingLeaves.map(leave => `
                <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong>${leave.employeeName}</strong>
                        <span style="font-size: 12px; color: var(--text-light);">${leave.date}</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <span style="padding: 2px 8px; border-radius: 12px; font-size: 11px; background: #ffc107; color: white;">${leave.type}</span>
                    </div>
                    ${leave.reason ? `<p style="font-size: 14px; margin-bottom: 10px;">${leave.reason}</p>` : ''}
                    <div>
                        <button class="btn btn-success" style="padding: 5px 12px; margin-right: 5px;" onclick="approveLeave('${leave.id}')">✓ Approve</button>
                        <button class="btn btn-danger" style="padding: 5px 12px;" onclick="rejectLeave('${leave.id}')">✗ Reject</button>
                    </div>
                </div>
            `).join('');
        }

        // Approve Leave Request
        function approveLeave(leaveId) {
            const leave = leaveRequests.find(l => l.id === leaveId);
            if (leave) {
                leave.status = 'approved';
                updateLeaveRequests();
                updateDashboardStats();
                generateLeaveCalendar();
                alert(`Leave approved for ${leave.employeeName} on ${leave.date}`);
            }
        }

        // Reject Leave Request
        function rejectLeave(leaveId) {
            const index = leaveRequests.findIndex(l => l.id === leaveId);
            if (index !== -1) {
                const leave = leaveRequests[index];
                leaveRequests.splice(index, 1);
                updateLeaveRequests();
                updateDashboardStats();
                generateLeaveCalendar();
                alert(`Leave rejected for ${leave.employeeName} on ${leave.date}`);
            }
        }

        // Generate Leave Calendar
        function generateLeaveCalendar() {
            const container = document.getElementById('leaveCalendar');
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Clear calendar
            container.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.style.fontWeight = 'bold';
                header.style.textAlign = 'center';
                header.style.padding = '10px 5px';
                header.style.background = 'var(--primary-color)';
                header.style.color = 'white';
                header.style.borderRadius = '5px';
                header.style.fontSize = '12px';
                header.textContent = day;
                container.appendChild(header);
            });
            
            // Add empty cells for days before month start
            const firstDay = new Date(year, month, 1).getDay();
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                container.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasLeave = leaveRequests.some(l => l.date === dateStr && l.status === 'approved');
                
                if (hasLeave) {
                    dayElement.classList.add('has-leave');
                    const leavesForDay = leaveRequests.filter(l => l.date === dateStr && l.status === 'approved');
                    dayElement.title = `Leaves: ${leavesForDay.map(l => l.employeeName).join(', ')}`;
                }
                
                container.appendChild(dayElement);
            }
        }

        // Schedule Generation
        document.getElementById('scheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const startDate = document.getElementById('startDate').value;
            const numDays = parseInt(document.getElementById('numDays').value);
            
            if (!startDate) {
                alert('Please select a start date!');
                return;
            }
            
            generateSchedule(startDate, numDays);
        });

        // Generate AI Schedule
        function generateSchedule(startDate, numDays) {
            const output = document.getElementById('scheduleOutput');
            output.innerHTML = '<p style="text-align: center;">🤖 AI is generating health-conscious schedule...</p>';
            
            // Simulate AI processing
            setTimeout(() => {
                const schedule = createHealthConsciousSchedule(startDate, numDays);
                displaySchedule(schedule);
            }, 2000);
        }

        // Create Health-Conscious Schedule
        function createHealthConsciousSchedule(startDate, numDays) {
            const schedule = {};
            const shifts = ['S1', 'S2', 'S3'];
            const requirements = {
                'S1': { 'Lead': 2, 'Associate': 4 },
                'S2': { 'Lead': 2, 'Associate': 4 },
                'S3': { 'Lead': 1, 'Associate': 2 }
            };
            
            // Track consecutive days for each employee
            const consecutiveDays = {};
            npeTeamData.forEach(emp => consecutiveDays[emp.id] = 0);
            
            for (let i = 0; i < numDays; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(currentDate.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayOfWeek = currentDate.getDay();
                
                schedule[dateStr] = {};
                
                // Check for approved leaves
                const approvedLeaves = leaveRequests.filter(l => l.date === dateStr && l.status === 'approved');
                const employeesOnLeave = approvedLeaves.map(l => l.employeeId);
                
                shifts.forEach(shift => {
                    schedule[dateStr][shift] = {};
                    
                    Object.keys(requirements[shift]).forEach(role => {
                        const needed = requirements[shift][role];
                        const availableEmployees = npeTeamData.filter(emp => 
                            emp.role === role && 
                            !employeesOnLeave.includes(emp.id) &&
                            consecutiveDays[emp.id] < 6 && // Health rule: max 6 consecutive days
                            !emp.daysOff.includes(dayOfWeek) // Respect preferred days off
                        ).sort((a, b) => consecutiveDays[a.id] - consecutiveDays[b.id]); // Prioritize those with fewer consecutive days
                        
                        schedule[dateStr][shift][role] = availableEmployees.slice(0, needed).map(emp => {
                            consecutiveDays[emp.id]++;
                            return emp.name;
                        });
                    });
                });
                
                // Reset consecutive days counter for employees who get a day off
                npeTeamData.forEach(emp => {
                    const isWorking = shifts.some(shift => 
                        Object.values(schedule[dateStr][shift]).some(roleAssignments => 
                            roleAssignments.includes(emp.name)
                        )
                    );
                    if (!isWorking) {
                        consecutiveDays[emp.id] = 0;
                    }
                });
            }
            
            scheduleData = schedule;
            return schedule;
        }

        // Display Generated Schedule
        function displaySchedule(schedule) {
            const output = document.getElementById('scheduleOutput');
            let html = '<div class="alert alert-success">✅ Health-conscious schedule generated successfully!</div>';
            
            html += '<table class="table" style="font-size: 12px;"><thead><tr><th>Date</th><th>S1 (Morning)</th><th>S2 (Afternoon)</th><th>S3 (Night)</th></tr></thead><tbody>';
            
            Object.keys(schedule).forEach(date => {
                const daySchedule = schedule[date];
                html += `<tr><td><strong>${date}</strong></td>`;
                
                ['S1', 'S2', 'S3'].forEach(shift => {
                    const shiftData = daySchedule[shift];
                    let shiftText = '';
                    
                    Object.keys(shiftData).forEach(role => {
                        const employees = shiftData[role];
                        if (employees.length > 0) {
                            shiftText += `<div><strong>${role}s:</strong> ${employees.join(', ')}</div>`;
                        }
                    });
                    
                    html += `<td>${shiftText || 'No assignments'}</td>`;
                });
                
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            output.innerHTML = html;
        }

        // Download Schedule as Excel
        function downloadSchedule() {
            if (!scheduleData) {
                alert('Please generate a schedule first!');
                return;
            }
            
            // Create Excel workbook
            const wb = XLSX.utils.book_new();
            const wsData = [['Date', 'S1 Leads', 'S1 Associates', 'S2 Leads', 'S2 Associates', 'S3 Leads', 'S3 Associates']];
            
            Object.keys(scheduleData).forEach(date => {
                const daySchedule = scheduleData[date];
                const row = [date];
                
                ['S1', 'S2', 'S3'].forEach(shift => {
                    const leads = daySchedule[shift]['Lead'] || [];
                    const associates = daySchedule[shift]['Associate'] || [];
                    row.push(leads.join(', '), associates.join(', '));
                });
                
                wsData.push(row);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'NPE Schedule');
            XLSX.writeFile(wb, 'NPE_ShiftBot_Schedule.xlsx');
        }

        // Initialize Reports
        function initReports() {
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Create gradient for line chart
            const lineGradient = ctx.createLinearGradient(0, 0, 0, 200);
            lineGradient.addColorStop(0, 'rgba(139, 95, 191, 0.8)');
            lineGradient.addColorStop(0.5, 'rgba(139, 95, 191, 0.4)');
            lineGradient.addColorStop(1, 'rgba(139, 95, 191, 0.1)');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['📅 Week 1', '📅 Week 2', '📅 Week 3', '📅 Week 4'],
                    datasets: [{
                        label: 'Average Working Days',
                        data: [4.2, 4.1, 4.3, 4.0],
                        borderColor: '#8b5fbf',
                        backgroundColor: lineGradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#8b5fbf',
                        pointBorderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointHoverBackgroundColor: '#ffd700',
                        pointHoverBorderColor: '#8b5fbf',
                        pointHoverBorderWidth: 4,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2500,
                        easing: 'easeInOutCubic',
                        delay: (context) => {
                            return context.dataIndex * 200;
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#8b5fbf',
                            borderWidth: 2,
                            cornerRadius: 10,
                            displayColors: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return tooltipItems[0].label.replace('📅 ', '');
                                },
                                label: function(context) {
                                    return `Average: ${context.parsed.y} days per week`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 7,
                            grid: {
                                color: 'rgba(139, 95, 191, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return value + ' days';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });
        }

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            
            // Set default start date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            
            // Register Service Worker for PWA functionality
            registerServiceWorker();
            
            // Add install app prompt
            setupInstallPrompt();
        });

        // PWA Service Worker Registration
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('./service-worker.js');
                    console.log('NPE ShiftBot: Service Worker registered successfully', registration);
                } catch (error) {
                    console.log('NPE ShiftBot: Service Worker registration failed', error);
                }
            }
        }

        // PWA Install Prompt
        let deferredPrompt;
        function setupInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                // Prevent the mini-infobar from appearing on mobile
                e.preventDefault();
                // Stash the event so it can be triggered later
                deferredPrompt = e;
                // Show install button
                showInstallButton();
            });
        }

        function showInstallButton() {
            // Create install button
            const installBtn = document.createElement('button');
            installBtn.className = 'btn btn-success';
            installBtn.innerHTML = '📱 Install App';
            installBtn.style.position = 'fixed';
            installBtn.style.bottom = '20px';
            installBtn.style.right = '20px';
            installBtn.style.zIndex = '1000';
            
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`NPE ShiftBot: User response to install prompt: ${outcome}`);
                    deferredPrompt = null;
                    installBtn.remove();
                }
            });
            
            document.body.appendChild(installBtn);
        }

        // Enhanced Local Storage with compression
        const Storage = {
            set: (key, value) => {
                try {
                    const compressed = JSON.stringify(value);
                    localStorage.setItem(`npe-shiftbot-${key}`, compressed);
                } catch (error) {
                    console.error('Storage error:', error);
                }
            },
            get: (key) => {
                try {
                    const item = localStorage.getItem(`npe-shiftbot-${key}`);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error('Storage error:', error);
                    return null;
                }
            },
            remove: (key) => {
                localStorage.removeItem(`npe-shiftbot-${key}`);
            }
        };

        // Auto-save functionality
        function autoSave() {
            Storage.set('leaveRequests', leaveRequests);
            Storage.set('scheduleData', scheduleData);
            Storage.set('lastSaved', new Date().toISOString());
        }

        // Load saved data on startup
        function loadSavedData() {
            const savedLeaves = Storage.get('leaveRequests');
            const savedSchedule = Storage.get('scheduleData');
            
            if (savedLeaves) {
                leaveRequests = savedLeaves;
            }
            
            if (savedSchedule) {
                scheduleData = savedSchedule;
            }
        }

        // Train AI with Excel data import
        function trainAIWithExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                alert('🧠 AI Training: Please select an Excel file (.xlsx or .xls)');
                return;
            }
            
            // Show AI training indicator
            const trainingIndicator = document.createElement('div');
            trainingIndicator.innerHTML = '🧠 AI Learning from Excel...';
            trainingIndicator.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                background: linear-gradient(135deg, #8b5fbf, #a374d0);
                color: white;
                padding: 8px 12px;
                border-radius: 20px;
                font-size: 12px;
                z-index: 1001;
                animation: pulse 1.5s infinite;
            `;
            document.body.appendChild(trainingIndicator);
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    let trainingData = {
                        teamData: [],
                        schedulePatterns: [],
                        leavePatterns: [],
                        insights: []
                    };
                    
                    // Extract team data for AI learning
                    if (workbook.SheetNames.includes('Team Data')) {
                        const teamSheet = workbook.Sheets['Team Data'];
                        const teamDataArray = XLSX.utils.sheet_to_json(teamSheet, { header: 1 });
                        
                        for (let i = 1; i < teamDataArray.length; i++) {
                            const row = teamDataArray[i];
                            if (row.length >= 4) {
                                trainingData.teamData.push({
                                    id: row[0],
                                    name: row[1],
                                    role: row[2],
                                    status: row[3],
                                    preferences: row[4]
                                });
                            }
                        }
                    }
                    
                    // Extract schedule patterns for AI learning
                    if (workbook.SheetNames.includes('Generated Schedule')) {
                        const scheduleSheet = workbook.Sheets['Generated Schedule'];
                        const scheduleArray = XLSX.utils.sheet_to_json(scheduleSheet, { header: 1 });
                        
                        for (let i = 1; i < scheduleArray.length; i++) {
                            const row = scheduleArray[i];
                            if (row.length >= 7) {
                                trainingData.schedulePatterns.push({
                                    date: row[0],
                                    s1_leads: row[1],
                                    s1_associates: row[2],
                                    s2_leads: row[3],
                                    s2_associates: row[4],
                                    s3_leads: row[5],
                                    s3_associates: row[6]
                                });
                            }
                        }
                    }
                    
                    // Extract leave patterns for AI learning
                    if (workbook.SheetNames.includes('Leave Requests')) {
                        const leaveSheet = workbook.Sheets['Leave Requests'];
                        const leaveArray = XLSX.utils.sheet_to_json(leaveSheet, { header: 1 });
                        
                        for (let i = 1; i < leaveArray.length; i++) {
                            const row = leaveArray[i];
                            if (row.length >= 6) {
                                trainingData.leavePatterns.push({
                                    employee: row[2],
                                    date: row[3],
                                    type: row[4],
                                    status: row[6]
                                });
                            }
                        }
                    }
                    
                    // AI learns from the data and generates insights
                    setTimeout(() => {
                        trainingData.insights = generateAIInsights(trainingData);
                        
                        // Store AI learning in browser for future use
                        Storage.set('aiTrainingData', trainingData);
                        Storage.set('aiLastTrained', new Date().toISOString());
                        
                        // Remove training indicator
                        trainingIndicator.remove();
                        
                        // Show AI training results
                        showAITrainingResults(trainingData);
                        
                        // Update current data with learned patterns if requested
                        if (confirm('🧠 AI has learned from your Excel data!\n\nWould you like to apply the learned patterns to update current schedules and preferences?')) {
                            applyAILearning(trainingData);
                        }
                        
                    }, 2000); // Simulate AI processing time
                    
                } catch (error) {
                    console.error('AI Training error:', error);
                    trainingIndicator.remove();
                    alert('🧠 AI Training failed. Please check the Excel file format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Generate AI insights from training data
        function generateAIInsights(data) {
            const insights = [];
            
            // Analyze team patterns
            if (data.teamData.length > 0) {
                const roles = data.teamData.map(t => t.role);
                const roleCount = roles.reduce((acc, role) => {
                    acc[role] = (acc[role] || 0) + 1;
                    return acc;
                }, {});
                
                insights.push(`Team composition: ${Object.entries(roleCount).map(([role, count]) => `${count} ${role}s`).join(', ')}`);
            }
            
            // Analyze schedule patterns
            if (data.schedulePatterns.length > 0) {
                const avgDaysWithSchedule = data.schedulePatterns.filter(s => s.s1_leads || s.s2_leads || s.s3_leads).length;
                insights.push(`Schedule coverage: ${((avgDaysWithSchedule / data.schedulePatterns.length) * 100).toFixed(1)}% of days scheduled`);
            }
            
            // Analyze leave patterns
            if (data.leavePatterns.length > 0) {
                const leaveTypes = data.leavePatterns.map(l => l.type);
                const typeCount = leaveTypes.reduce((acc, type) => {
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                const mostCommonLeave = Object.entries(typeCount).sort((a, b) => b[1] - a[1])[0];
                insights.push(`Most common leave type: ${mostCommonLeave[0]} (${mostCommonLeave[1]} requests)`);
            }
            
            insights.push(`AI processed ${data.teamData.length} team members, ${data.schedulePatterns.length} schedule entries, ${data.leavePatterns.length} leave records`);
            
            return insights;
        }
        
        // Show AI training results
        function showAITrainingResults(data) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            content.innerHTML = `
                <h3 style="color: #8b5fbf; margin-bottom: 20px;">🧠 AI Training Complete!</h3>
                <div style="margin-bottom: 20px;">
                    <h4>AI Insights:</h4>
                    <ul style="margin-left: 20px;">
                        ${data.insights.map(insight => `<li>${insight}</li>`).join('')}
                    </ul>
                </div>
                <div style="text-align: center;">
                    <button onclick="this.closest('.ai-modal').remove()" style="
                        background: linear-gradient(135deg, #8b5fbf, #a374d0);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 20px;
                        cursor: pointer;
                        font-weight: bold;
                    ">Got it! 🚀</button>
                </div>
            `;
            
            modal.className = 'ai-modal';
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Auto-close after 10 seconds
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.remove();
                }
            }, 10000);
        }
        
        // Apply AI learning to current data
        function applyAILearning(data) {
            // This function would apply learned patterns to improve scheduling
            // For now, we'll just show a confirmation
            alert('🧠 AI patterns applied! The system will now use learned preferences for future scheduling.');
            
            // Update dashboard to reflect AI learning
            updateDashboardStats();
        }

        // Add small import button in corner for AI training
        function addSmartImportButton() {
            const importBtn = document.createElement('button');
            importBtn.innerHTML = '🧠';
            importBtn.title = 'Train AI with Excel data';
            importBtn.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                width: 35px;
                height: 35px;
                border-radius: 50%;
                background: linear-gradient(135deg, #8b5fbf, #a374d0);
                color: white;
                border: none;
                font-size: 16px;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(139, 95, 191, 0.3);
                z-index: 1000;
                transition: all 0.3s ease;
            `;
            
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.xlsx,.xls';
            fileInput.style.display = 'none';
            fileInput.onchange = trainAIWithExcel;
            
            importBtn.onmouseover = () => {
                importBtn.style.transform = 'scale(1.1)';
                importBtn.style.boxShadow = '0 6px 16px rgba(139, 95, 191, 0.4)';
            };
            
            importBtn.onmouseout = () => {
                importBtn.style.transform = 'scale(1)';
                importBtn.style.boxShadow = '0 4px 12px rgba(139, 95, 191, 0.3)';
            };
            
            importBtn.onclick = () => fileInput.click();
            
            document.body.appendChild(importBtn);
            document.body.appendChild(fileInput);
        }

        // Add backup/restore functionality to UI
        function addBackupButtons() {
        // Legacy backup/restore UI removed. Only smart import button remains.
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            addSmartImportButton();
            
            // Auto-save every 30 seconds
            setInterval(autoSave, 30000);
        });
    </script>
</body>
</html>
